# здесь поменять перменную на то, как ты хочешь чтобы альбом назывался на диске
ALBUM_TITLE='cats'; 
# здесь заменяешь имя файла на тот, который ты только что скачал в консоли, т.е. сам сохраненный альбом
ALBUM_HTML_FILE='cats_2.txt'
# твой мейл
USERID='email@example.com';
# твой пароль вместо password
PASSWORD='password';

# переезжаем в соответствующую папку.
mkdir $ALBUM_TITLE && cd $ALBUM_TITLE;

# достаем собственно нужный стринг с айди вида на фотку и сохраняем список в отдельный файл.
grep -oP 'a href=".\K.*?(?=[?"])' ../$ALBUM_HTML_FILE | grep photo > pics_views_links.txt;

# можно глянуть, что там. количество строк с ссылками должно быть такое же, как и количество фоток в альбоме. откомменти, если там тыщи, терминал офигеет.
cat pics_views_links.txt;

# это не работает, увы, хотя вгет совершает авторизацию через https. решение: открыть страницу альбома для всех, кроме поисковиков, и продолжать скрейпить без авторизации
# wget --save-cookies=my-cookies.txt --keep-session-cookies --user=email@example.com ​--ask-password https://login.vk.com/;

# теперь собственно скачиваем сами хтмл с видами фоток, то есть те окошка с черной рамкой, где показываются фотки, когда кликаешь, там внутри есть 
# ссылки на .жпг фотки, причем в разных разрешениях.
for pic_view in $(cat pics_views_links.txt); do wget https://vk.com/$(echo $pic_view); done;

# тк у нас в директории много всего другого, выбираем только то, что начинается на фото* и сохраняем в отдельный файл.
ls photo* > pics_pages.txt;

# можно глянуть. откомменти, если много.
cat pics_pages.txt | wc -l;

# сохраняем возможные префиксы в файлик столбиком, чтобы потом было легче итерировать и сохранять в разные директории в зависимости от разрешения.
# фотки в хорошем разрешении будут в w, y, x, z, тем временем как в o, p, q, r будет мелочь по пару кб, можешь оставить только первые 4 буквы.
# в w будет самое лучшее качество, в x, из того что я поняла, будет фотка в том разрешении, в котором она показывается в черной рамке. 
# лучше скачать все четыре буквы как минимум (т.е. w, y, x, z), так как не всегда все разрешения есть, это зависит от изначального размера фотки,
# особенно это касается w.
printf "x\ny\nz\nw\no\np\nq\nr" > letters.txt;

# на всякий случай можно глянуть что там и сколько.
cat letters.txt | wc -l;

# из каждой сохраненной хтмл страницы достаем фотки в разных разрешениях и сохраняем ссылки в соответствующие файлы.
for pic in $(cat pics_pages.txt); do for letter in $(cat letters.txt); do grep -aoP "$letter"'_src...https:....\K.*?\Wjpg\W*?(?=")' $pic | grep -v "<" | tee -a ${letter}_src.txt; done; done;

# теперь создаем директории для разных разрешений и отсортировываем уникальные ссылки в файлах с ссылками на .жпг (их станoвится во много раз меньше),
# потом убираем бэкслэши которые были в хтмл файлах изначально, иначе вгет ничего не поймет и не скачает
for letter in $(cat letters.txt); do mkdir ${letter}_src; sort -u ${letter}_src.txt > ${letter}_src_unique.txt; sed 's/[\]//g' ${letter}_src_unique.txt > ${letter}_src_unique_formatted.txt; done;

# а теперь скачиваем фотки в каждом разрешении и сохраняем их в соответствующих директориях
for letter in $(cat letters.txt); do for link in $(cat ${letter}_src_unique_formatted.txt); do wget $link -P ${letter}_src; done; done;

# убираем за собой и возвращаемся в изначальную директорию
rm *.txt photo*;
cd ..;
